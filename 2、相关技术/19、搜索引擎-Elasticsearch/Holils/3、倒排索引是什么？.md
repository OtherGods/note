#倒排索引是一种索引结构用于快速搜索某个词汇在那个文档中 #文档：对应数据库中一条记录 #词条：对应文档中每个字段中的词语 
#正排索引：文档ID与文档的映射 #倒排索引：词条与文档ID的映射 
#倒排索引搜索流程 #倒排索引建立流程 #分词 

# 典型回答

## 名词解析

在 ElasticSearch 中，倒排索引是一种常用的 **==索引结构==**，用于快速搜索文档中的某个词汇。

倒排索引中有两个非常重要的概念：
- 文档（`Document`）：用来搜索的数据，每一条数据就是一个文档；**对应MySQL表中的一条记录**。例如一个网页、一个商品信息
- 词条（`Term`）：对文档数据或用户搜索数据，利用某种算法分词，得到的具备含义的词语就是词条；**对应MySQL表中一条记录中某字段中的词语**。例如：我是中国人，就可以分为：我、是、中国人、中国、国人这样的几个词条

**==倒排索引的结构与传统的索引结构相反==**：
1. *==正向索引==*：==是由*文档ID*与*文档*的映射构成==。
2. *==倒排索引==*：==是由*词汇*与*文档ID*的映射构成==；每个文档包含了若干个词汇，索引中记录的是文档中词汇与文档ID的映射。
【<font color="red" size=5>我的理解：正向索引是根据位置（索引）找文档（表中的记录）；倒排索引是根据文档的内容（文档中的词语/词条）找位置，找到位置或再次获取对应的文档</font>】
![1.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202506201836795.png)

对于一个包含多个词汇的文档，倒排索引会将每个词汇作为一个关键字（Term），然后记录下该词汇所在的文档编号（Document ID）及该词汇在文档中的位置（Term Position）。这样，当用户输入一个关键字时，就可以快速地查找到包含该关键字的文档编号，然后通过文档编号再查找到对应的文档内容。

**倒排索引的优点在于它==可以快速定位包含指定词条的文档==，而且可以支持复杂的搜索操作，如词组搜索、通配符搜索等**。同时，由于倒排索引是由词汇构成的，因此在进行数据分析和统计时也非常有用。在 ElasticSearch 中，倒排索引是一种非常重要的索引结构，它被广泛应用于搜索引擎、日志分析、推荐系统等领域。

## 倒排索引的搜索流程

以搜索"华为手机"为例：
1. 用户输入条件`"华为手机"`进行搜索。
2. 对用户输入内容**分词**，得到词条：`华为`、`手机`。
3. **拿着词条在==倒排索引==中查找文档ID**，可以得到包含词条的文档id：1、2、3。
4. **拿着文档ID到==正排索引==中查找具体文档**。
如图：
![image-20210720201115192.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202509211823046.png)

虽然要先查询倒排索引，再查询正排索引，但是无论是词条、还是文档id都建立了索引，查询速度非常快！无需全表扫描。

## 正排和倒排

1. **正排索引**是最传统的，根据id索引的方式。但 **==根据词条查询==** 时，必须先逐条获取每个文档，也就是 **==全表扫描==**，然后 **==判断文档中是否包含所需要的词条==**，是**根据文档找词条的过程**。
	- 优点：
	  - 可以给多个字段创建索引
	  - 根据索引字段搜索、排序速度非常快
	- 缺点：
	  - 根据**非索引字段、索引字段中的部分词条**查找时，只能全表扫描
2. **倒排索引**则相反，是先找到用户要搜索的词条，根据词条得到包含词条的文档的id，然后根据id获取文档。是**根据词条找文档的过程**。
	- 优点：
	  - 根据词条搜索、模糊搜索时，速度非常快
	- 缺点：
	  - 只能给词条创建索引，而不是字段
	  - 无法根据字段做排序

# 扩展知识

## 倒排索引建立过程

ES中的倒排索引建立过程主要有2个步骤，分别是分词、建立倒排索引

比如我们现在有三份文档内容，分别是
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202506201858984.png)

## 分词

在倒排索引建立过程中，首先需要将文档中的原始文本分解成一个个词项（Term）。Elasticsearch 中默认使用标准分词器（Standard Analyzer）进行分词。

以上三个文本内容，我们经过分词之后，就会包含了"深入"、"理解"、"Java"、"核心"、"技术"、"编程"、"思想"、"Hollis"、"周志明"、"布鲁斯·埃克尔"等词

## 生成倒排索引

将分开的词，当做索引，与对应的文档ID进行关联，形成倒排表。
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202506201858870.png)

在生成了倒排表后，还会对倒排表进行压缩，减少空间占用。常用的压缩算法包括Variable Byte Encoding和Simple9等。最后再将压缩后的倒排表存储在磁盘中，以便后续的搜索操作能够快速地访问倒排表。
