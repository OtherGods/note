# 典型回答

压测是一种非常常见的帮我们做性能评估的手段。通过模拟用户请求，帮助我们发现系统的瓶颈以及评估系统的整体水位。

以下是进行压测的一般步骤：

1. **确定测试目标**：明确进行压测的目标，具体是哪个接口，那个方法，哪种具体的case。以及这次压测我们要实现什么目的，是测试300QPS能不能扛得住，还是看看系统的整体水位咋样。
2. **制定压测计划**：确定压测的具体策略，包括测试的时间、持续多久、并发量要压到多少、是一次性压到指标还是脉冲式压上去、测试环境配置等。
3. **创建环境并准备脚本**：压测可以在测试环境也可以在生产环境，但是不管是硬件配置、部署架构还是代码，都需要和线上环境尽量保持一致。并且需要准备好压测数据及脚本，是不同的用户，还是相同的用户，是写数据还是读数据。都是不一样的。
4. **执行压测**：根据测试计划，执行压测并收集性能指标。可以逐步增加负载，观察系统的响应情况。
5. **监控系统性能**：施压不是目的，目的是在施压过程中，观察系统的整体情况。包括但不限于：
	a. QPS、RT、失败率、CPU利用率、Load、内存情况、GC次数、GC时长、网络IO情况、堆内存情况、线上报警情况等。
6. **分析结果**：对压测结果进行分析，确定系统的性能瓶颈和潜在问题，并采取相应的优化措施。
7. **优化和再测试**：根据分析结果，进行必要的优化和改进，并重新进行压测，直到系统能够满足预期的性能要求。

常用的压测工具包括JMeter、Apache Bench等，它们可以帮助自动化执行压测脚本，并提供详细的测试报告和性能分析。在进行压测时，需要特别注意对生产环境的影响，确保不会对实际用户造成不良影响。因此，在压测前务必仔细准备，并充分评估风险。

## 指标范围（ChatGPT）

| **指标**         | **正常范围**                    | **警戒线**                   | **说明**                         |
| -------------- | --------------------------- | ------------------------- | ------------------------------ |
| **QPS**        | 日常：5k-50k  <br>大促：50k-200k+ | 持续超设计容量20%                | 依赖分库分表、缓存优化、流量削峰               |
| **RT(响应时间)**   | P99 ≤ 100ms  <br>AVG ≤ 50ms | P99 > 300ms 或 AVG > 100ms | 包含网络+DB+缓存+逻辑处理时间              |
| **失败率**        | < 0.1%                      | > 1% 或 持续上升               | 需区分业务失败（库存不足）和系统失败（超时/异常）      |
| **CPU利用率**     | 峰值 ≤ 70%                    | 持续 > 80% 或 单核跑满           | 需关注是否出现锁竞争、频繁GC导致的CPU毛刺        |
| **Load(系统负载)** | ≤ CPU核心数 × 0.7              | > CPU核心数 × 1.5            | 如4核机器Load>6需紧急排查               |
| **内存利用率**      | ≤ 70%                       | > 85% 或 OOM               | 关注堆外内存（Netty/DirectBuffer）泄漏风险 |
| **Young GC**   | 频率：≤ 2次/秒  <br>时长：≤ 50ms    | 频率 > 10次/秒 或 时长 > 200ms   | 高频率GC可能因短生命周期对象过多              |
| **Full GC**    | 频率：≤ 1次/小时  <br>时长：≤ 1秒     | 频率 > 1次/分 或 时长 > 3秒       | 频繁Full GC通常存在内存泄漏或大对象分配        |
| **网络IO**       | 入向/出向 ≤ 网卡带宽70%             | 持续饱和或丢包率 > 0.1%           | 万兆网卡上限约1.25GB/s，需监控TCP重传率      |
| **堆内存**        | Old区 ≤ 70%  <br>Meta区稳定     | Old区 > 90% 或 Meta区持续增长    | Old区突增可能因缓存失效导致穿透              |
| **线上报警**       | 无核心报警                       | 库存超卖/数据不一致/集群宕机           | 业务报警优先级 > 系统报警                 |

# 扩展知识

## JMeter

JMeter是一个功能强大的开源性能测试工具，由Apache软件基金会开发和维护。它主要用于进行压力测试、负载测试和性能测试，以评估Web应用程序、Web服务、数据库和其他类型的服务在不同负载条件下的性能。

jmeter官网：[https://jmeter.apache.org/](https://jmeter.apache.org/)

给大大家推荐一篇我同事写的jemer实践经验：[https://www.talkwithtrend.com/Article/245389](https://www.talkwithtrend.com/Article/245389)，想要了解这个工具怎么用的，可以看下这篇文章。

总之，这个是目前比较主流的压测工具。

## 全链路压测

[6、什么是全链路压测？](2、相关技术/23、高并发高可用高性能/高可用/Hollis/6、什么是全链路压测？.md)


