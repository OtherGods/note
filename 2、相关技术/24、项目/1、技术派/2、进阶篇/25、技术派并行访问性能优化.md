
æ€§èƒ½è°ƒä¼˜å¯ä»¥è¯´æ˜¯è´¯ç©¿æ¯ä¸€ä¸ªç ”å‘çš„èŒä¸šç”Ÿæ¶¯çš„ï¼Œå¯¹äºä¸€ä¸ªåˆæ ¼çš„åç«¯è€Œè¨€ï¼Œå¦‚æœå‘ç°æŸä¸ªé¡µé¢åŠ è½½å¾ˆæ…¢ï¼Œæ¥å£å“åº”è€—æ—¶è¾ƒå¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè¿›è¡Œä¼˜åŒ–å‘¢ï¼Ÿ

é€šå¸¸å¯¹äºåç«¯è€Œè¨€ï¼Œæœ‰å‡ ä¸ªæœ€ç®€å•çš„ä¼˜åŒ–æ€è·¯ï¼›
1. åŠ æœºå™¨
2. åŠ ç¼“å­˜
3. ä¸²è¡Œæ”¹å¹¶è¡Œ

æ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹æŠ€æœ¯æ´¾ä¸­é’ˆå¯¹ä¸Šé¢çš„ç¬¬ä¸‰ç‚¹ï¼Œä¸²è¡Œæ”¹å¹¶è¡Œæ˜¯æ€ä¹ˆæ”¯æŒçš„

# 1ã€ä½¿ç”¨åœºæ™¯

å¯¹äºä¸²è¡Œæ”¹å¹¶è¡Œçš„ä¼˜åŒ–æ–¹å¼ï¼Œè¯·æ³¨æ„å¹¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚ç”¨ï¼›å†é€‚ç”¨è¿™ç§æ–¹æ¡ˆä¹‹å‰ï¼Œè¯·å…ˆåšå¥½å……åˆ†çš„è®¤çŸ¥

ä»¥æŠ€æœ¯æ´¾ä¸ºä¾‹ï¼Œä»€ä¹ˆåœºæ™¯ä¼šé€‚åˆåˆ©ç”¨å¹¶è¡Œæ¥æé«˜æ¥å£å“åº”æ€§èƒ½å‘¢ï¼Ÿ
- å†ä»£ç çš„å®ç°ä¸­ï¼Œä¸»è¦æ˜¯é¦–é¡µè¿›è¡Œäº†è¿™ç§æ–¹å¼çš„ä¼˜åŒ–

**why?**

![1.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202403031553858.png)


æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹é¦–é¡µçš„å¸ƒå±€ï¼Œæœ‰å››å¤§ç‰ˆå—ä¿¡æ¯å±•ç¤ºå‡ºæ¥äº†ï¼›è€Œä¸”è¿™äº›æ¿å—æœ‰ä¸€ä¸ªè¾ƒå¤§çš„ç‰¹ç‚¹ï¼›æ¿å—ä¸æ¿å—ä¹‹é—´æ²¡æœ‰å‰åä¾èµ–å…³ç³»ï¼Œå³å®ƒä»¬çš„ä¿¡æ¯è·å–å®Œå…¨æ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œ

è¿™ç§åœºæ™¯åŒæ ·ç»™å¤§å®¶ä¸¾ä¸€ä¸ªå¦å¤–å¥½ç†è§£çš„ä¾‹å­ï¼Œç”µå•†çš„è¯¦æƒ…é¡µï¼Œå‡è®¾åç«¯æ˜¯ä¸€ä¸ªæ¥å£è¿”å›æ‰€æœ‰çš„ä¿¡æ¯

é‚£ä¹ˆå•†å“è¯¦æƒ…ä¿¡æ¯ï¼Œæ¨èå•†å“ä¿¡æ¯ï¼Œåº—é“ºä¿¡æ¯ï¼Œè¯„ä»·ä¿¡æ¯ï¼Œå¹¿å‘Šä½ä¿¡æ¯ç­‰æ²¡æœ‰ä¾èµ–çš„ä¿¡æ¯å°è£…æœåŠ¡ï¼Œä¹ŸåŒæ ·æ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„

# 2ã€å¹¶è¡Œè®¿é—®æ”¹é€ å®ä¾‹
## 2.1ã€æ”¹é€ ç›®æ ‡

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹éœ€è¦æ”¹é€ çš„åœ°æ–¹ï¼Œå…¥å£åœ¨ IndexRecommendHelper#buildIndexVo()
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202401032233784.png)

çœ‹ä¸€ä¸‹ä¸Šé¢çš„å®ç°ï¼Œå…¶ä¸­é™¤äº†ç¬¬ä¸€ä¸ªè·å–ç±»ç›®ä¿¡æ¯çš„æ–¹æ³•è¦å…ˆæ‰§è¡Œä¹‹å¤–ï¼Œå‰©ä½™çš„å…¶ä»–ä¿¡æ¯è¡¥å……ï¼Œéƒ½æ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„

æˆ‘ä»¬æ¥ç»Ÿè®¡ä¸‹å„ä¸ªæ–¹æ³•çš„è€—æ—¶ä»¥åŠæ•´ä¸ªæ¥å£çš„è€—æ—¶æƒ…å†µï¼Œè¿™é‡Œç›´æ¥å€ŸåŠ©Springçš„StopWatchæ¥å®ç°ç»Ÿè®¡
```java
public IndexVo buildIndexVo(String activeTab) {
    IndexVo vo = new IndexVo();
    CategoryDTO category = categories(activeTab, vo);
    StopWatch stopWatch = new StopWatch("é¦–é¡µä¿¡æ¯è¿”å›");
    stopWatch.start("ç±»ç›®æ–‡ç« è·å–");
    vo.setArticles(articleList(category.getCategoryId()));
    stopWatch.stop();
    
    stopWatch.start("ç½®é¡¶æ–‡ç« è·å–");
    vo.setTopArticles(topArticleList(category));
    stopWatch.stop();
    
    stopWatch.start("è½®æ’­å›¾è·å–");
    vo.setHomeCarouselList(homeCarouselList());
    stopWatch.stop();
    
    stopWatch.start("ä¾§è¾¹æ ä¿¡æ¯");
    vo.setSideBarItems(sidebarService.queryHomeSidebarList());
    stopWatch.stop();
    
    vo.setCurrentCategory(category.getCategory());
    vo.setCategoryId(category.getCategoryId());
    stopWatch.start("ç™»å½•ç”¨æˆ·ä¿¡æ¯è·å–");
    vo.setUser(loginInfo());
    stopWatch.stop();
    prettyPrint(stopWatch);
    return vo;
}

// å› ä¸ºstopWatché»˜è®¤è¾“å‡ºçš„æ˜¯çº³ç§’ï¼›ä¸ºäº†å¤§å®¶æ›´å¥½çš„ç†è§£è€—æ—¶ï¼Œæˆ‘ä»¬æ¢æˆmsè¿›è¡Œè¾“å‡º
private void prettyPrint(StopWatch stopWatch) {
    StopWatch.TaskInfo[] taskInfos = stopWatch.getTaskInfo();
    StringBuilder sb = new StringBuilder();
    sb.append('\n');
    sb.append("StopWatch '").append(stopWatch.getId()).append("': running time = ").append(stopWatch.getTotalTimeMillis()).append(" ms");
    sb.append('\n');
    if (taskInfos.length < 1) {
        sb.append("No task info kept");
    } else {
        sb.append("---------------------------------------------\n");
        sb.append("ms         %     Task name\n");
        sb.append("---------------------------------------------\n");
        NumberFormat nf = NumberFormat.getNumberInstance();
        nf.setMinimumFractionDigits(3);
        nf.setGroupingUsed(false);
        NumberFormat pf = NumberFormat.getPercentInstance();
        pf.setMinimumIntegerDigits(2);
        pf.setMinimumFractionDigits(2);
        pf.setGroupingUsed(false);
        for (StopWatch.TaskInfo task : taskInfos) {
            sb.append(nf.format(task.getTimeNanos() / 1000_000.0)).append("  ");
            sb.append(pf.format((double) task.getTimeNanos() / stopWatch.getTotalTimeNanos())).append("  ");
            sb.append(task.getTaskName()).append("\n");
        }
    }
    System.out.println(sb.toString());
}
```

å®é™…æ‰§è¡Œè€—æ—¶åˆ†å¸ƒæƒ…å†µï¼ˆæ’é™¤é¦–æ¬¡å¯åŠ¨æ—¶çš„è®¿é—®æƒ…å†µï¼Œå› ä¸ºç¼“å­˜è¿˜æ²¡æœ‰åŠ è½½ï¼‰
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202401032255041.png)

ç”±äºä¸Šé¢æ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆæŒ‰ç…§ä¹è§‚ä¼°è®¡ï¼Œè‹¥æ”¹æˆå¹¶è¡Œè®¿é—®ï¼Œè€—æ—¶å°†åœ¨80msï¼Œæ•´ä½“æ€§èƒ½æå‡ 60%+

## 2.2ã€å¹¶è¡Œæ”¹é€ 

å°†ä¸²è¡Œè°ƒç”¨æ”¹æˆå¹¶è¡Œæ”¹é€ ï¼Œæœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹å¼å°±æ˜¯æ¯ä¸ªè°ƒç”¨æ”¾åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œç„¶åç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹ååœ¨è¿”å›ç»“æœ

å¦‚ç›´æ¥ä½¿ç”¨çº¿ç¨‹è®¿é—®
```java
FutureTask<PageListVo<ArticleDTO>> futureTask = new FutureTask<>(() -> articleList(category.getCategoryId()));
new Thread(futureTask).start();
vo.setArticles(futureTask.get());

// ä¸‹é¢çš„ç±»ä¼¼ï¼Œçœç•¥
```

æˆ–è€…å€ŸåŠ©çº¿ç¨‹æ± æ¥æ‰§è¡Œ

```java
Future<PageListVo<ArticleDTO>> ans = AsyncUtil.submit(() -> articleList(category.getCategoryId()));
vo.setArticles(ans.get());
```

è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸€ä¸‹æŠ€æœ¯æ´¾ä¸­å€ŸåŠ©CompletableFutureæ¥å®ç°å¹¶è¡Œè®¿é—®çš„ä½¿ç”¨å§¿åŠ¿

### 2.2.1ã€CompletableFutureåŸºç¡€çŸ¥è¯†ç‚¹

> ä»¥ä¸‹å†…å®¹æ¥è‡ª â€œæ´¾èªæ˜â€ çš„å›ç­”
> 
> CompletableFuture æ˜¯ Java8 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚
> ä¸‹é¢æ˜¯ä½¿ç”¨ CompletableFuture çš„ä¸€äº›å¸¸è§å§¿åŠ¿è¯´æ˜ï¼š
> 1. åˆ›å»º CompletableFuture å®ä¾‹ï¼š
>    æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CompletableFuture çš„é™æ€æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª CompletableFuture å®ä¾‹ï¼Œæ¯”å¦‚ CompletableFuture.supplyAsync()æˆ–CompletableFuture.runAsync() å¯ä»¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡ã€‚supplyAsync()ç”¨äºæ‰§è¡Œæœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ï¼ŒrunAsync()ç”¨äºæ‰§è¡Œæ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ã€‚
> 2. å¼‚æ­¥æ“ä½œï¼š
>    CompletableFuture å¯ä»¥æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ thenApply()ã€thenAccept()ã€thenAcceptBoth()ã€thenRun() ç­‰æ–¹æ³•æ¥å¯¹å¼‚æ­¥æ“ä½œçš„ç»“æœè¿›è¡Œå¤„ç†
> 3. å¼‚å¸¸å¤„ç†ï¼š
>    æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œå¦‚ exceptionally()ã€handle()ã€whenComplete() ç­‰æ¥å¤„ç†å¼‚æ­¥æ“ä½œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸ã€‚exceptionally()æ–¹æ³•ç”¨äºå¤„ç†å¼‚å¸¸æƒ…å†µï¼Œå¹¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè€Œhandle()æ–¹æ³•å¯ä»¥å¤„ç†å¼‚å¸¸å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»“æœã€‚
> 4. ç»„åˆå¤šä¸ª CompletableFuture å®ä¾‹ï¼š
>    ä½¿ç”¨ thenCompose()ã€thenCombine()ã€allOf() ç­‰æ–¹æ³•å¯ä»¥å°†å¤šä¸ª CompletableFuture å®ä¾‹ä¸²è”èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå¼‚æ­¥æ“ä½œé“¾ã€‚
> 5. ç»„åˆå¤šä¸ªCompletableFutureå¯¹è±¡ï¼š
>    å¯ä»¥ä½¿ç”¨allOf()ã€anyOf()å’Œjoin()ç­‰æ–¹æ³•æ¥ç»„åˆå¤šä¸ªCompletableFutureå¯¹è±¡ã€‚allOf()æ–¹æ³•åœ¨æ‰€æœ‰CompletableFutureå¯¹è±¡éƒ½å®Œæˆåè¿”å›ä¸€ä¸ªVoidç±»å‹çš„CompletableFutureå¯¹è±¡ï¼ŒanyOf()æ–¹æ³•åœ¨ä»»æ„ä¸€ä¸ªCompletableFutureå¯¹è±¡å®Œæˆåè¿”å›ä¸€ä¸ªæ–°çš„CompletableFutureå¯¹è±¡ã€‚
> 6. å–æ¶ˆå¼‚æ­¥æ“ä½œï¼š
>    æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CompletableFuture çš„ cancel() æ–¹æ³•æ¥å–æ¶ˆå¼‚æ­¥æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ isCancelled() æ–¹æ³•æ¥åˆ¤æ–­å¼‚æ­¥æ“ä½œæ˜¯å¦å·²ç»è¢«å–æ¶ˆã€‚
> 7. ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆå¹¶è·å–ç»“æœï¼š
>    ä½¿ç”¨ get() æ–¹æ³•å¯ä»¥ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå¹¶è·å–æ“ä½œçš„ç»“æœï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å¼‚æ­¥ä»»åŠ¡å®Œæˆå¹¶è¿”å›ç»“æœã€‚
>    è¿˜å¯ä»¥ä½¿ç”¨join()æ–¹æ³•æ¥è·å–ç»“æœï¼Œä½†å®ƒä¸ä¼šæŠ›å‡ºå—æ£€å¼‚å¸¸ã€‚
>    å¯ä»¥ä½¿ç”¨ getNow() æ–¹æ³•æ¥è·å–æ“ä½œçš„ç»“æœï¼Œå¦‚æœæ“ä½œå°šæœªå®Œæˆï¼Œåˆ™è¿”å›é»˜è®¤å€¼ã€‚
> 8. è®¾ç½®è¶…æ—¶ï¼š
>    æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CompletableFuture çš„ completeOnTimeout()ã€orTimeout() ç­‰æ–¹æ³•æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ŒcompleteOnTimeout()æ–¹æ³•åœ¨æŒ‡å®šçš„æ—¶é—´å†…å®Œæˆæ—¶è¿”å›ç»“æœï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚orTimeout()æ–¹æ³•åœ¨æŒ‡å®šçš„æ—¶é—´å†…å®Œæˆæ—¶è¿”å›ç»“æœï¼Œå¦åˆ™æŠ›å‡ºTimeoutExceptionå¼‚å¸¸ã€‚

ä»¥ä¸Šæ˜¯ CompletableFuture çš„ä¸€äº›å¸¸è§ä½¿ç”¨å§¿åŠ¿ï¼Œå…·ä½“ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥ç»„åˆå¼‚æ­¥æ“ä½œã€‚

### 2.2.2ã€å¹¶è¡Œè°ƒåº¦å°è£…å·¥å…·ç±»CompletableFutureBridge

ä¸ºäº†æ›´æ–¹ä¾¿çš„å®ç°å¹¶è¡Œè®¿é—®è°ƒåº¦ï¼ŒæŠ€æœ¯æ´¾ä¸­å¯¹CompletableFutureåšäº†æ˜“ç”¨æ€§çš„å°è£…ï¼Œå¹¶æ”¯æŒè€—æ—¶æ‰“å°

æºç åœ°å€è·¯å¾„ï¼š com.github.paicoding.forum.core.async.AsyncUtil.CompletableFutureBridge

å°†ä¸€äº›åé¢ä½¿ç”¨åˆ°çš„æ ¸å¿ƒç‚¹ç»™å¤§å®¶è´´å‡ºæ¥ï¼Œç»™å‡ºä¸€äº›è®¾è®¡è¯´æ˜
```java
public static class CompletableFutureBridge {
    private List<CompletableFuture> list;
    private Map<String, Long> cost;
    private String taskName;
    
    public CompletableFutureBridge() {
        this("CompletableFutureExecute");
    }
    
    public CompletableFutureBridge(String task) {
        this.taskName = task;
        list = new ArrayList<>();
        cost = new ConcurrentHashMap<>();
        cost.put(task, System.currentTimeMillis());
    }
    
    /**
     * å¼‚æ­¥å¹¶å‘æ‰§è¡Œï¼Œå¹¶è®°å½•è€—æ—¶
     *
     * @param run  å…·ä½“éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡
     * @param name è€—æ—¶çš„æ ‡è®°
     * @return
     */
     public CompletableFutureBridge runAsyncWithTimeRecord(Runnable run, String name) {
        list.add(CompletableFuture.runAsync(runWithTime(run, name)));
        return this;
    }
    
    public CompletableFutureBridge runAsyncWithTimeRecord(Runnable run, String name, ExecutorService executor) {
        list.add(CompletableFuture.runAsync(runWithTime(run, name), executor));
        return this;
    }
    
    private Runnable runWithTime(Runnable run, String name) {
        return () -> {
            startRecord(name);
            try {
                run.run();
            } finally {
                endRecord(name);
            }
        };
    }
    
    public CompletableFutureBridge allExecuted() {
        CompletableFuture.allOf(ArrayUtil.toArray(list, CompletableFuture.class)).join();
        endRecord(this.taskName);
        return this;
    }
    
    private void startRecord(String name) {
        cost.put(name, System.currentTimeMillis());
    }
    
    private void endRecord(String name) {
        long now = System.currentTimeMillis();
        cost.put(name, now - cost.getOrDefault(name, now));
    }
    
    public void prettyPrint() {
        StringBuilder sb = new StringBuilder();
        sb.append('\n');
        long totalCost = cost.remove(taskName);
        sb.append("StopWatch '").append(taskName).append("': running time = ").append(totalCost).append(" ms");
        sb.append('\n');
        if (cost.size() <= 1) {
            sb.append("No task info kept");
        } else {
            sb.append("---------------------------------------------\n");
            sb.append("ms         %     Task name\n");
            sb.append("---------------------------------------------\n");
            NumberFormat pf = NumberFormat.getPercentInstance();
            pf.setMinimumIntegerDigits(2);
            pf.setMinimumFractionDigits(2);
            pf.setGroupingUsed(false);
            for (Map.Entry<String, Long> entry : cost.entrySet()) {
                sb.append(entry.getValue()).append("\t\t");
                sb.append(pf.format(entry.getValue() / (double) totalCost)).append("\t\t");
                sb.append(entry.getKey()).append("\n");
            }
        }
        if (!EnvUtil.isPro()) {
            log.info("\n---------------------\n{}\n--------------------\n", sb);
        }
    }
}
```

ä¸Šé¢çš„å®ç°è™½è¯´çœ‹ç€å†…å®¹æœ‰ç‚¹å¤šï¼Œå•æ ¸å¿ƒç‚¹ä¸»è¦å°±ä¸¤å—ï¼š

1. å¹¶å‘æ‰§è¡Œ
```java
// æ·»åŠ ä»»åŠ¡
CompletableFuture future = CompletableFuture.runAsync(run);

// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•
CompletableFuture.allOf(new CompletableFuture[]{future, ...}).join();
```

2. è®°å½•æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œè€—æ—¶
æ³¨æ„ä¸Šé¢çš„å®ç°æ²¡æœ‰ç”¨å‰é¢æåˆ°çš„StopWatchï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒéçº¿ç¨‹å®‰å…¨ï¼›å› æ­¤æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„è€—æ—¶ç»Ÿè®¡
```java
// è®°å½•æ¯ä¸ªä»»åŠ¡ï¼Œä»¥åŠæ€»çš„è€—æ—¶æƒ…å†µ
Map<String, Long> cost;

// ä»»åŠ¡æ‰§è¡Œå¼€å§‹å‰ï¼Œè®°å½•å½“å‰æ—¶é—´
private void startRecord(String name) {
    cost.put(name, System.currentTimeMillis());
}

// ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè®°å½•ä»»åŠ¡æ‰§è¡Œè€—æ—¶
private void endRecord(String name) {
    long now = System.currentTimeMillis();
    cost.put(name, now - cost.getOrDefault(name, now));
}
```

### 2.2.3ã€å¹¶è¡Œæ‰§è¡Œè°ƒåº¦

åœ¨AysncUtilä¸­ï¼Œç»™ä¸Šé¢çš„å°è£…ç±»æä¾›äº†ä¸€ä¸ªç®€å•çš„å®ä¾‹åŒ–æ–¹å¼
```java
public static CompletableFutureBridge concurrentExecutor(String... name) {  
    if (name.length > 0) {  
        return new CompletableFutureBridge(name[0]);  
    }  
    return new CompletableFutureBridge();  
}
```

ç„¶åæˆ‘ä»¬å°†IndexRecommendHelperä¸­çš„å®ç°å§¿åŠ¿è¿›è¡Œæ›¿æ¢
```java
public IndexVo buildIndexVo(String activeTab) {  
    IndexVo vo = new IndexVo();  
    CategoryDTO category = categories(activeTab, vo);  
    vo.setCategoryId(category.getCategoryId());  
    vo.setCurrentCategory(category.getCategory());  
    // å¹¶è¡Œè°ƒåº¦å®ä¾‹ï¼Œæé«˜å“åº”æ€§èƒ½  
    AsyncUtil.concurrentExecutor("é¦–é¡µå“åº”")  
            .runAsyncWithTimeRecord(() -> vo.setArticles(articleList(category.getCategoryId())), "æ–‡ç« åˆ—è¡¨")  
            .runAsyncWithTimeRecord(() -> vo.setTopArticles(topArticleList(category)), "ç½®é¡¶æ–‡ç« ")  
            .runAsyncWithTimeRecord(() -> vo.setHomeCarouselList(homeCarouselList()), "è½®æ’­å›¾")  
            .runAsyncWithTimeRecord(() -> vo.setSideBarItems(sidebarService.queryHomeSidebarList()), "ä¾§è¾¹æ ")  
            .runAsyncWithTimeRecord(() -> vo.setUser(loginInfo()), "ç”¨æˆ·ä¿¡æ¯")  
            .allExecuted()  
            .prettyPrint();  
    return vo;  
}
```

ä¸‹é¢æ˜¯ä¸²è¡Œæ”¹å¹¶è¡Œçš„ä½¿ç”¨å§¿åŠ¿å¯¹æ¯”ï¼Œå®é™…ä¸Šä¹Ÿæ²¡æœ‰å¢åŠ æºç çš„é˜…è¯»éšœç¢ï¼ˆè‡ªæˆ‘æ„Ÿè§‰è¿˜æ˜¯æŒºå¥½ç†è§£çš„ğŸ˜€ï¼‰
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202401042330604.png)

æ¥ä¸‹æ¥å†çœ‹ä¸€ä¸‹å®é™…çš„è®¿é—®è€—æ—¶æƒ…å†µï¼Œæ•´ä½“è€—æ—¶ä¾ç„¶å–å†³ä¸è€—æ—¶æœ€ä¹…çš„æ–‡ç« åˆ—è¡¨è¿”å›ï¼ˆä¸è¿‡å•å°±å®ƒçš„å“åº”è€—æ—¶ç”±ä¹‹å‰çš„80mså˜ä¸º31msä¹Ÿæ˜¯æˆ‘æ²¡æƒ³åˆ°çš„ï¼Œä¸€èˆ¬æ¥è¯´ä¸²è¡Œæ”¹å¹¶è¡Œå¹¶ä¸ä¼šå½±å“å®ƒçš„è€—æ—¶å˜åŒ–ï¼Œä¸»è¦å˜æ›´åŸå› å¤§æ¦‚ç‡æ˜¯æˆ‘ç¬”è®°æœ¬çš„ä¸ç¨³å®šå¯¼è‡´çš„,æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æœ¬æœºå®é™…æ¨¡æ‹ŸéªŒè¯ä¸€ä¸‹ï¼‰
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202401042331322.png)

## 2.3ã€å°ç»“

è¿™ä¸€èŠ‚çš„å†…å®¹æ¯”è¾ƒç®€å•ï¼Œå®ç°å§¿åŠ¿ä¸»è¦æ˜¯é jdk8+çš„CompletableFutureï¼Œæ‰€ä»¥å®ƒçš„ä½¿ç”¨å§¿åŠ¿ï¼Œè¯·å„ä½å°ä¼™ä¼´åŠ¡å¿…è¦å­¦ä¼š

é‡ç‚¹éœ€è¦è¯´çš„æ˜¯è¿™ä¸ªæ€§èƒ½æå‡çš„æ€æƒ³ï¼Œä¸²è¡Œæ”¹å¹¶è¡Œï¼Œå¯ä»¥è¯´æ˜¯æˆ‘ä»¬å†åšæ€§èƒ½æå‡æ—¶ï¼Œé™¤å¼€ç¼“å­˜ä¹‹åæœ€å¸¸ç”¨çš„æ‰‹æ®µï¼Œä¸€èˆ¬ä¿©è¯´ï¼Œæ”¹å¹¶è¡Œçš„éš¾åº¦ä»æ¥ä¸å†ç¼–ç å®ç°ä¸Šï¼Œæ›´å¤šéœ€è¦è€ƒè™‘çš„ç‚¹æ˜¯ï¼š

1. çº¿ç¨‹æ± ç›¸å…³å‚æ•°æ€ä¹ˆè®¾ç½®ï¼Ÿ
2. æŸä¸ªä»»åŠ¡æ‰§è¡Œå¼‚å¸¸æ€ä¹ˆå¤„ç†ï¼Ÿ
3. ç›‘æ§æ€ä¹ˆåšï¼Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ä¿¡æ¯æ˜¯å¦ä¼šä¸¢ï¼Ÿ
4. å¦‚æœæœ‰äº‹åŠ¡çš„åœºæ™¯ï¼Œæ³¨æ„ä¸»å­çº¿ç¨‹å¯¼è‡´çš„äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜


