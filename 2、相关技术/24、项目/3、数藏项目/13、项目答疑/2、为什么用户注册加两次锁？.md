在我们的用户注册相关的代码中，很多人发现我加锁加了2次，

第一次加锁：
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202503122248520.png)

通过@DistributeLock(keyExpression = "#telephone", scene = "USER_REGISTER")对整个方法，针对手机号加了分布式锁。

第二次加锁：
![image.png](https://raw.githubusercontent.com/OtherGods/MaterialImage/main/img/202503122249051.png)

在updateInviteRank这个方法中，又用 Redisson 加了一次锁，为啥要加两次呢？

因为锁的对象不一样，第一次加锁，锁的是注册者的手机号，防止重复注册。

第二次加锁，锁的是邀请人的 ID，避免一个人邀请的多个用户同时注册导致积分少加。

比如说 A 邀请 B 来注册，第一次加锁是针对 B 的手机号加锁，第二次加锁是针对 A 的 ID 加锁，所以他们各自都有自己的职责，缺一不可的。

