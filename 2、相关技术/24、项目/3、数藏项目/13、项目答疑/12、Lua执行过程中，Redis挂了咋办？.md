有一个特殊的场景，就是我们库存扣减不使用的lua脚本么，在脚本执行过程中，先扣减数据库，再写入库存流水的。

那么，如果出现一种极端情况，那就是lua执行时，库存扣减成功了，但是库存流水还没等写入，Redis挂了。怎么办？

首先，这种Redis挂了的情况，是一定需要人工介入的，不可能说一个强依赖的中间件挂了，开发没有任何感知。

那么，当我们把Redis恢复之后，如何识别出上面这种特殊情况呢？

还记得我们的库存流水吗长什么样子吗？
```json
{
	"change": "1",
	"action": "decrease",
	"from": "21",
	"timestamp": 1718017957347,
	"by": "\"29_cba99dfd-2bc7-4787-8992-263fbcbe3e7d_1\"",
	"to": 20
}
```

这里面有form、和to，标识这本次扣件记录是从多少扣到了多少。正常情况下，这个数据一定是连续的。即：

from 100 to 99，from 99 to 98 , from 98 to 97 .....

那么如果出现了 from 100 to 99，from 98 to 97 ,中间的from 99 to 98是丢了的，那么就意味着上面我们说的情况可能发生了。这时候人工确认后把库存加回去就行了。


