在我们的秒杀第二套方案中，用了 MQ 做削峰填谷，既然用了 MQ 就可能存在消息堆积的问题，如果堆积了怎么办？

首先呢，想要削峰填谷就要面临堆积的这个问题。换句话说，可用性和一致性，总要有个取舍。

所以这个问题其实没办法彻底避免，因为数据库的能力就是有限的，如果无限我们也就不需要用 MQ 了，所以，就可能会出现延迟的。

那延迟怎么办呢？其实，用户订单如果还没有创建成功，他也是看不到这个订单的，他也无法支付，他感受到的就是系统繁忙，处理中类似这样的状态。

所以，我们在这里，下单时，redis 扣减成功返回了订单号之后，前端会轮询这个订单的状态，如果发现已经CONFIRM 了再唤起收银台。

其实很多大型电商也有这个情况，就是下单的时候提示你失败了，但是你去订单列表可能就发现已经创建成功一笔订单了。


