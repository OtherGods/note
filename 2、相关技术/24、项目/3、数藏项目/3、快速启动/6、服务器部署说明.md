
我们的项目计划后期会通过Jenkins+Docker 来实现部署，但是目前一期还没有接入（别打我，快马加鞭在搞了。。。

所以，目前我们只能通过 jar 包的方式把应用启动起来。

### 服务器配置要求

[1、服务器配置说明](2、相关技术/24、项目/3、数藏项目/2、中间件部署/1、服务器配置说明.md)

### 轻量级部署

上面的表格中有一列是否必须，其中 N 的部分表示你可以不用自己部署，或者不用一直部署。

那怎么运转呢？

那就是用我们给大家部署的一套公共的服务就行了。这样最低的话需要8G内存把 Nacos 和应用启起来也够了。

### 服务器推荐

为了帮大家节省成本，我找阿里云申请了一些服务器的福利。比自己去官网订购要便宜的多。**但是需要是新用户，大家只需要弄个新手机号注册一个阿里云账号即可！**

| 服务器规格 | 原价  | 优惠价   | 专属链接                          | 说明  |
| ----- | --- | ----- | ----------------------------- | --- |
| 2C2G  | -   | 99/年  | https://t.aliyun.com/U/4VBjj6 | 限1台 |
| 2C4G  | -   | 199/年 | https://t.aliyun.com/U/GWPrZA | 限1台 |

**专属优惠链接有时间和数量限制，可能会定期失效，我会定期更新，如发现价格变动请不要购买，联系我更新链接即可。**

### 应用部署

应用的启动和部署暂时用 jar 形式，后续改成其他方案。

jar 包如何获取

在你的模块的目录下（如nft-turbo-business），执行`maven package`后，即可到 target 目录（如nft-turbo-business/nft-turbo-app/target/nft-turbo-app-1.0.0-SNAPSHOT.jar）下找到 jar 包。

#### business 模块启动

```shell
nohup java -jar -DDUBBO_IP_TO_REGISTRY=139.11.11.11 -Xms2g -Xmx2g -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m -XX:MaxDirectMemorySize=1g -Xlog:gc:/root/logs/app/gc.log -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/root/logs/app/java.hprof -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005 -Dspring.cloud.nacos.discovery.ip=139.11.11.11 nft-turbo-app-1.0.0-SNAPSHOT.jar &
```

这里的139.11.11.11替换成你自己的 ip。

这个命令用于在 Linux 或 Unix 系统上启动一个 Java 应用程序，并在后台运行，同时输出日志和错误信息。以下是对该命令中各个部分的解释：

**`nohup`**
- **作用**：`nohup`（no hangup）命令用于忽略 HUP（挂起）信号。使用 `nohup` 启动的进程即使终端关闭也会继续运行。
- **输出重定向**：默认情况下，`nohup` 会将标准输出和错误输出重定向到一个文件 `nohup.out`，除非你手动指定了输出文件。

**`java -jar`**
- **作用**：`java` 命令用于运行 Java 程序，`-jar` 参数指定要运行的 JAR 文件。

**`-DDUBBO_IP_TO_REGISTRY=139.11.11.11`**
- **作用**：通过 `-D` 选项设置系统属性。这会将系统属性 `DUBBO_IP_TO_REGISTRY` 设置为 `139.11.11.11`，通常用于配置 Dubbo 框架中的注册中心 IP。

**`-Xms2g`**
- **作用**：设置 JVM 的初始堆内存大小为 2GB。JVM 在启动时会立即分配这部分内存。

**`-Xmx2g`**
- **作用**：设置 JVM 的最大堆内存大小为 2GB。堆内存最大不会超过这个值。

**`-XX:MetaspaceSize=512m`**
- **作用**：设置 JVM 元空间（Metaspace）的初始大小为 512MB。Metaspace 用于存放类元数据。

**`-XX:MaxMetaspaceSize=512m`**
- **作用**：设置 JVM 元空间的最大大小为 512MB。元空间超出这个大小会触发垃圾回收。

**`-XX:MaxDirectMemorySize=1g`**
- **作用**：设置 JVM 最大直接内存大小为 1GB。直接内存用于 NIO（非阻塞 I/O）等场景。

**`-Xlog:gc:/root/logs/app/gc.log`**
- **作用**：配置 JVM 将垃圾回收（GC）日志输出到 `/root/logs/app/gc.log` 文件中。

**`-XX:+PrintGCDetails`**
- **作用**：启用详细的垃圾回收日志信息。这会输出每次 GC 的详细信息，包括时间、类型、内存使用等。

**`-XX:+HeapDumpOnOutOfMemoryError`**
- **作用**：当发生 `OutOfMemoryError` 异常时，JVM 会生成堆转储文件，帮助分析内存泄漏等问题。

**`-XX:HeapDumpPath=/root/logs/app/java.hprof`**
- **作用**：指定堆转储文件的保存路径为 `/root/logs/app/java.hprof`。

**`-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005`**
- **作用**：启用远程调试功能：
  - `transport=dt_socket`：使用套接字传输。
  - `server=y`：开启调试服务器模式。
  - `suspend=n`：不暂停启动，即在启动时不等待调试器连接。
  - `address=*:5005`：指定调试监听端口为 5005，并接受来自任意地址的调试连接。

**`-Dspring.cloud.nacos.discovery.ip=139.11.11.11`**
- **作用**：通过 `-D` 选项设置系统属性 `spring.cloud.nacos.discovery.ip`，这通常用于指定 Nacos 的服务发现 IP 地址。

**`nft-turbo-app-1.0.0-SNAPSHOT.jar`**
- **作用**：这是要运行的 JAR 文件名称，`nft-turbo-app-1.0.0-SNAPSHOT.jar` 是具体的应用程序文件。

**`&`**
- **作用**：将命令放入后台执行。命令执行后，终端会立即返回命令提示符，而应用程序会在后台继续运行。

**总结**
这个命令使用了 `nohup` 让 Java 应用程序在后台运行，即使终端关闭也不会停止。它还配置了多个 JVM 参数，包括内存设置、垃圾回收日志、堆转储、远程调试等，最后运行了一个名为 `nft-turbo-app-1.0.0-SNAPSHOT.jar` 的 JAR 文件。

#### auth 模块启动

```shell
nohup java -jar -Xms2g -Xmx2g -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m -XX:MaxDirectMemorySize=1g -Xlog:gc:/root/logs/app/gc.log -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/root/logs/app/java.hprof -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005 -DDUBBO_IP_TO_REGISTRY=139.11.11.11 -Dspring.cloud.nacos.discovery.ip=139.11.11.11 nft-turbo-auth-1.0.0-SNAPSHOT.jar &
```

这里的139.11.11.11替换成你自己的 ip。

#### gateway 模块启动

```shell
nohup java -jar -Xms2g -Xmx2g -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m -XX:MaxDirectMemorySize=1g -Xlog:gc:/root/logs/app/gc.log -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/root/logs/app/java.hprof -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005 -Dspring.cloud.nacos.discovery.ip=139.11.11.11 nft-turbo-gateway-1.0.0-SNAPSHOT.jar &
```

这里的139.11.11.11替换成你自己的 ip。


[6.1、服务器部署注意事项](2、相关技术/24、项目/3、数藏项目/3、快速启动/6.1、服务器部署注意事项.md)


### ChatGPT补充

这些 Java 参数用于配置 JVM 的内存管理、垃圾回收日志、诊断信息、远程调试和 Spring Cloud Nacos 的相关设置。下面是每个参数的详细解释及其命名含义：

#### 内存管理相关参数

1. **`-Xms<size>`**
   - 含义：设置初始堆内存大小。
   - 命名含义：`Xms` 表示 "eXtra memory start"，即 JVM 启动时分配的初始堆内存大小。
   - 例子：`-Xms512m` 表示初始堆内存为 512 MB。

2. **`-Xmx<size>`**
   - 含义：设置最大堆内存大小。
   - 命名含义：`Xmx` 表示 "eXtra memory max"，即 JVM 可使用的最大堆内存大小。
   - 例子：`-Xmx1024m` 表示最大堆内存为 1024 MB。

3. **`-XX:MetaspaceSize=<size>`**
   - 含义：设置初始元空间（Metaspace）大小。
   - 命名含义：`MetaspaceSize` 表示元空间的初始大小。
   - 例子：`-XX:MetaspaceSize=128m` 表示初始元空间大小为 128 MB。

4. **`-XX:MaxMetaspaceSize=<size>`**
   - 含义：设置最大元空间（Metaspace）大小。
   - 命名含义：`MaxMetaspaceSize` 表示元空间的最大大小。
   - 例子：`-XX:MaxMetaspaceSize=256m` 表示最大元空间大小为 256 MB。

5. **`-XX:MaxDirectMemorySize=<size>`**
   - 含义：设置最大直接内存（Direct Memory）大小。
   - 命名含义：`MaxDirectMemorySize` 表示直接内存的最大大小。
   - 例子：`-XX:MaxDirectMemorySize=512m` 表示最大直接内存为 512 MB。

#### 垃圾回收和日志相关参数

6. **`-Xlog:gc:/root/logs/app/gc.log`**
   - 含义：将垃圾回收（GC）日志输出到指定文件。
   - 命名含义：`Xlog:gc` 表示开启垃圾回收日志，`/root/logs/app/gc.log` 是日志文件路径。
   - 例子：`-Xlog:gc:/root/logs/app/gc.log` 将 GC 日志输出到 `/root/logs/app/gc.log`。

7. **`-XX:+PrintGCDetails`**
   - 含义：打印垃圾回收的详细信息。
   - 命名含义：`PrintGCDetails` 表示打印 GC 的详细信息。
   - 例子：`-XX:+PrintGCDetails` 开启 GC 详细信息输出。

#### 诊断和调试相关参数

8. **`-XX:+HeapDumpOnOutOfMemoryError`**
   - 含义：在发生内存不足（OutOfMemoryError）时生成堆转储（heap dump）。
   - 命名含义：`HeapDumpOnOutOfMemoryError` 表示在内存不足时生成堆转储。
   - 例子：`-XX:+HeapDumpOnOutOfMemoryError` 开启内存不足时的堆转储。

9. **`-XX:HeapDumpPath=<path>`**
   - 含义：指定堆转储文件的路径。
   - 命名含义：`HeapDumpPath` 表示堆转储文件的保存路径。
   - 例子：`-XX:HeapDumpPath=/root/logs/app/java.hprof` 将堆转储文件保存到 `/root/logs/app/java.hprof`。

10. **`-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005`**
    - 含义：配置远程调试参数。
    - 命名含义：`jdwp` 表示 Java Debug Wire Protocol，用于远程调试。
        - `transport=dt_socket`：使用套接字传输。
        - `server=y`：作为调试服务器启动。
        - `suspend=n`：JVM 启动时不暂停，等待调试客户端连接。
        - `address=*:5005`：监听所有网络接口上的 5005 端口。

#### Spring Cloud Nacos 相关参数

11. **`-Dspring.cloud.nacos.discovery.ip=<ip>`**
    - 含义：配置 Spring Cloud Nacos 的服务发现 IP 地址。
    - 命名含义：`-D` 表示定义一个系统属性，`spring.cloud.nacos.discovery.ip` 是 Nacos 服务发现的 IP 地址。
    - 例子：`-Dspring.cloud.nacos.discovery.ip=139.11.11.11` 表示将 Nacos 服务发现的 IP 地址设置为 `139.11.11.11`。

#### 示例

假设我们将所有这些参数应用于一个 Java 应用程序启动命令，命令行如下：

```sh
java -Xms512m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m -XX:MaxDirectMemorySize=512m -Xlog:gc:/root/logs/app/gc.log -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/root/logs/app/java.hprof -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005 -Dspring.cloud.nacos.discovery.ip=139.11.11.11 -jar your-application.jar
```

这个命令配置了内存管理、GC 日志、堆转储、远程调试和 Spring Cloud Nacos 服务发现的相关参数，确保应用在运行时有足够的内存，并能在出现问题时提供详细的诊断信息和调试支持。

##### 参数解释
##### 1. **扩展选项 (Extended Options)**

扩展选项是指由 JVM 提供的非标准选项，它们通常用于调整或控制 JVM 的内部行为或性能，但并不是 Java 标准规范的一部分。这些选项允许开发人员对 JVM 进行更细粒度的配置。

扩展选项通常包括：
- **`-XX`** 系列选项：这些是专门为 JVM 内部调优而设计的选项。它们并非 Java 标准的一部分，因此可能在不同版本的 JVM 中有所不同。它们通常涉及性能调优、垃圾回收、内存管理等。

例如：
- **`-XX:+PrintGCDetails`**：打印垃圾回收的详细信息。
- **`-XX:MaxHeapFreeRatio`**：设置堆内存中最大空闲空间的比例。
- **`-XX:+HeapDumpOnOutOfMemoryError`**：在发生 `OutOfMemoryError` 时生成堆转储。

这些选项是 JVM 扩展提供的，它们帮助开发人员更灵活地控制 JVM 的行为。

##### 2. **非标准选项 (Non-Standard Options)**

非标准选项是指 JVM 的启动参数，这些参数不是 Java 官方规范的一部分，通常是用于某些特定 JVM 实现或工具的设置，而不一定在所有的 JVM 实现中都有效。虽然它们对某些 JVM 实现有效，但可能会在不同的 JVM 实现中不兼容或不被支持。

非标准选项通常是 JVM 实现者（如 Oracle、OpenJ9、GraalVM 等）为特定版本的 JVM 提供的额外功能或配置选项。

例如：
- **`-D` 系列选项：** 用于设置 Java 系统属性。虽然 `-D` 系列选项是标准的，但它们的值可能是针对特定应用或 JVM 实现的。
- **`-agentlib:jdwp`**：这个选项指定了调试工具的设置，它并不属于 Java 标准规范的一部分，而是专门为调试提供的扩展。

##### 3、区别总结：

- **扩展选项（Extended Options）** 通常是 JVM 的特殊配置，用于控制 JVM 的内部行为，虽然它们是 JDK 提供的，但它们可能在不同版本的 JVM 中有所变化。它们是 JVM 提供的额外配置。
- **非标准选项（Non-Standard Options）** 是一些不属于 Java 标准规范的启动参数，它们可能是针对某些特定 JVM 实现或者工具（例如调试、性能监控工具）提供的，通常只能在特定的 JVM 实现或特定的工具中使用。

##### 4、常见的扩展和非标准选项：

- **扩展选项**：
  - `-XX:+PrintGCDetails`
  - `-XX:MaxDirectMemorySize`
  - `-XX:+UseG1GC`
  
- **非标准选项**：
  - `-D` 系列（例如：`-Duser.language=en`）
  - `-agentlib` 系列（例如：`-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005`）

总体来说，扩展选项和非标准选项都不属于 Java 标准，但是它们为开发人员提供了更多的调优和自定义的可能性。