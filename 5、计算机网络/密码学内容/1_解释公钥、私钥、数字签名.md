# 1、深入浅出-公钥、私钥、数字签名最通俗的理解

**<font color = "blue">这部分的内容仅仅是描述了原理，并没有很深入的分析，仅仅可以作为入门式解释，具体内容看2、3中转载的阮一峰的文章。</font>**

## 1、**公钥**加密 

假设一下，我找了两个数字，一个是1，一个是2。我喜欢2这个数字，就保留起来，不告诉你们(私钥），然后我告诉大家，1是我的[公钥](https://so.csdn.net/so/search?q=公钥&spm=1001.2101.3001.7020)。
我有一个文件，不能让别人看，我就用1[加密](https://so.csdn.net/so/search?q=加密&spm=1001.2101.3001.7020)了。别人找到了这个文件，但是他不知道2就是解密的私钥啊，所以他解不开，只有我可以用数字2，就是我的私钥，来解密。这样我就可以保护数据了。我的好朋友x用我的公钥1加密了字符a，加密后成了b，放在网上。别人偷到了这个文件，但是别人解不开，因为别人不知道我的私钥是2，只有我才能解密，解密后就得到a。这样，我们就可以传送加密的数据了。

## 2、**私钥**签名

引子：     如果我用私钥加密一段数据（当然只有我可以用私钥加密，因为只有我知道2是我的私钥），结果所有的人都看到我的内容了，因为他们都知道我的公钥是1**【这就是私钥签名的含义，就相当于我告诉大家：这段数据是我用我的私钥加密的，你们只要在网上搜到我的公钥，就可以得到密文对应的明文】**，那么这种加密有什么用处呢？

## 3、实例1：【举例私钥签名】

​     某天我的好朋友x说有人冒充我给他发信。怎么办呢？我把我要发的信，内容是c，用我的私钥2，加密，加密后的内容是d，发给x，再告诉他在网上搜到我的公钥，解密看是不是c。他用我的公钥1解密，发现果然是c。这个时候，他会想到，能够用我的公钥解密的数据，必然是用我的私钥加的密。只有我知道我的私钥，因此他就可以确认确实是我发的东西。

## 4、实例2：【对实例1的完善】

​     如果我们只想让x看到我想要给他发送的消息，那么我就可以用x的公钥对d进行加密，这样就只有x能用自己的私钥解密，x使用自己的私钥解密获得d之后没使用我的公钥对d再次解密，如果成功解密，x就可以知道这个**密文是我专门发给他的**。

## 5、**实例分析**

​     **在这个两个实例的过程中我先用我的私钥对数据c加密（结果为d），确保x知道是谁给他发送的消息，之后用x的公钥对d加密，确保d只有x可以解密。**     

## 6、总结

​     通过我们用自己的私钥给消息加密，别人就能确认发送方身份是我了。这个过程叫做[数字签名](https://so.csdn.net/so/search?q=数字签名&spm=1001.2101.3001.7020)。当然具体的过程要稍微复杂一些。用私钥来加密数据，用途就是**数字签名**。【具体的数字签名的内容可以看下面两部分（都是转载自阮一峰的文章，里面解释的很详细）】
三、总结公钥和私钥是成对的，它们相互解密；公钥加密，私钥解密；私钥数字签名，公钥验证。

一张形象的图：

![d6aijn3u](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\d6aijn3u.bmp)

以上内容来自：http://blog.csdn.net/21aspnet/article/details/7249401



# 2、密码学笔记

1. 加密方法可以分为两大类。一类是单钥加密（private key cryptography），还有一类叫做双钥加密（public key cryptography）。前者的加密和解密过程都用同一套密码，后者的加密和解密过程用的是两套密码。历史上，人类传统的加密方法都是前一种，比如二战期间德军用的Enigma电报密码。莫尔斯电码也可以看作是一种私钥加密方法。
2. 在单钥加密的情况下，密钥只有一把，所以密钥的保存变得很重要。一旦密钥泄漏，密码也就被破解。
3. 在双钥加密的情况下，密钥有两把，一把是公开的公钥，还有一把是不公开的私钥。双钥加密的原理如下：
   1. 公钥和私钥是一一对应的关系，有一把公钥就必然有一把与之对应的、独一无二的私钥，反之亦成立。
   2.  所有的（公钥, 私钥）对都是不同的。
   3. 用公钥可以解开私钥加密的信息，反之亦成立。
   4. 同时生成公钥和私钥应该相对比较容易，但是从公钥推算出私钥，应该是很困难或者是不可能的。
4. 目前，通用的单钥加密算法为DES（Data Encryption Standard），通用的双钥加密算法为RSA（ Rivest-Shamir-Adleman），都产生于上个世纪70年代。
5. 在双钥体系中，**公钥用来加密信息，私钥用来数字签名**【也就是防止信息被篡改】。
6. 因为任何人都可以生成自己的（公钥，私钥）对，所以为了防止有人散布伪造的公钥骗取信任，就需要一个可靠的第三方机构来生成经过认证的（公钥，私钥）对【也就是通过这个机构进行身份验证】。目前，世界上最主要的数字服务认证商是位于美国加州的[Verisign](https://www.verisign.com/)公司，它的主要业务就是分发RSA数字证书。

以上内容来自：https://www.ruanyifeng.com/blog/2006/12/notes_on_cryptography.html

# 3、数字签名+数字证书

## 1、描述

今天，我读到一篇[好文章](http://www.youdzone.com/signature.html)。

它用图片通俗易懂地解释了，"数字签名"（digital signature）和"数字证书"（digital certificate）到底是什么。

我对这些问题的理解，一直是模模糊糊的，很多细节搞不清楚。

读完这篇文章后，发现思路一下子就理清了。为了加深记忆，我把文字和图片都翻译出来了。

文中涉及的密码学基本知识，可以参见我以前的[笔记](https://www.ruanyifeng.com/blog/2006/12/notes_on_cryptography.html)【也就是上一部分的内容】。

**数字签名是什么？**

作者：David Youd

翻译：阮一峰

原文网址：http://www.youdzone.com/signature.html

1. ![img](http://www.ruanyifeng.com/blogimg/asset/201108/bg2011080901.png)鲍勃有两把钥匙，一把是公钥，另一把是私钥。
   
   

2. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080902.png)鲍勃把公钥送给他的朋友们----帕蒂、道格、苏珊----每人一把。【这里是从最原始的场景一步步推出现有的数字签名，也就是说在这一步的场景下还没有用到CA这种机构】
   
   

3. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080903.png)苏珊要给鲍勃写一封保密的信。她写完后用鲍勃的公钥加密，就可以达到保密的效果。
   
   

4. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080904.png)鲍勃收信后，用私钥解密，就看到了信件内容。这里要强调的是，只要鲍勃的私钥不泄露，这封信就是安全的，即使落在别人手里，也无法解密。
   
   

5. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080905.png)鲍勃给苏珊回信，决定采用"数字签名"。他写完后先用Hash函数，生成信件的摘要（digest）。
   
   

6. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080906.png)然后，鲍勃使用私钥，对这个摘要加密，生成"数字签名"（signature）。
   
   
   
7. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080907.png)鲍勃将这个签名，附在信件下面，一起发给苏珊（这里如果要更精细的话应该是：鲍勃应该把信件和数字签名一起使用苏珊的公钥加密，将加密后的内容发送给苏珊；）。【这里说的鲍勃发送信件的方式仅仅是为了说明数字签名的含义以及作用】

   数字签名的作用是：防止信息被篡改，不能用来作身份验证，原因可以去看第10步

   

8. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080908.png)苏珊收信后，取下数字签名，用鲍勃的公钥解密，得到信件的摘要。由此证明，这封信确实是鲍勃发出的。
   
   

9. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080909.png)苏珊再对信件本身使用Hash函数，将得到的结果，与上一步得到的摘要进行对比。如果两者一致，就证明这封信未被修改过。【到了这里仅仅是解释了数字签名的含义】
   
   

10. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080910.png)复杂的情况出现了。道格想欺骗苏珊，他偷偷使用了苏珊的电脑，用自己的公钥换走了鲍勃的公钥。此时，苏珊实际拥有的是道格的公钥，但是还以为这是鲍勃的公钥。因此，道格就可以冒充鲍勃，用自己的私钥做成"数字签名"，写信给苏珊，让苏珊用假的鲍勃公钥进行解密。


    【这一步和第七步中鲍勃做的事情类似，区别仅仅是苏珊拥有的公钥不是鲍勃的而是道格的，这一步说明了数字签名为什么不能作为身份认证的原因】


​    

11. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080911.png)后来，苏珊感觉不对劲，发现自己无法确定公钥是否真的属于鲍勃。她想到了一个办法，要求鲍勃去找"证书中心"（certificate authority，简称CA），为公钥做认证。证书中心用自己的私钥，对鲍勃的公钥和一些相关信息一起加密，生成"数字证书"（Digital Certificate）。
    
    

12. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080912.png)鲍勃拿到数字证书以后，就可以放心了。以后再给苏珊写信，只要在加上数字签名的同时，再附上数字证书就行了。
    
    

13. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080913.png)苏珊收信后，用CA的公钥解开数字证书，就可以拿到鲍勃真实的公钥了，然后就能证明"数字签名"是否真的是鲍勃签的。

    **【可以理解到CA的作用：用自己的私钥给所有注册到CA机构的人的公钥和相关信息加密，生成一个数字证书，这样大家只要在本地电脑保存CA的公钥，就可以获得CA使用私钥加密后的别人的公钥，防止本地保存的别人的公钥被不法分子换成不法分子自己的公钥从而达到伪装别人发送信息的情况】。**
    
    

14. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080914.jpg)下面，我们看一个应用"数字证书"的实例：https协议。这个协议主要用于网页加密。
    
15. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080915.png)首先，客户端向服务器发出加密请求。
    
16. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080916.png)服务器用自己的私钥加密网页以后，连同本身的数字证书，一起发送给客户端。
    
17. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080917.png)客户端（浏览器）的"证书管理器"，有"受信任的根证书颁发机构"列表。客户端会根据这张列表，查看解开数字证书的公钥是否在列表之内。
    
18. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080918.png)如果数字证书记载的网址，与你正在浏览的网址不一致，就说明这张证书可能被冒用，浏览器会发出警告。
    
19. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080919.jpg)如果这张数字证书不是由受信任的机构颁发的，浏览器会发出另一种警告。
    
20. ![img](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\bg2011080920.png)如果数字证书是可靠的，客户端就可以使用证书中的服务器公钥，对信息进行加密，然后与服务器交换加密信息。



从这篇文章中可以知道：

1. 数字签名的作用：防止信息被篡改
2. 数字证书的作用：防止不法分子伪装别人发送信息，认证身份；关于数字证书认证身份的图解：
   ![image-20220912224446215](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\image-20220912224446215.png)

具体的HTTPS建立连接的方式以及其具体过程的内容可以去看图解网络中Http篇中的内容（下图中圈住的内容）
![image-20220912230448778](D:\Tyora\AssociatedPicturesInTheArticles\解释公钥、私钥、数字签名\image-20220912230448778.png)

## 2、总结

**<font color = "red">1.1~1.9：</font>**解释数字签名怎么方式信息被篡改，在1.10中说明了为什么私钥加密不能验证身份的原因（在第一部分中说数字签名可以用来验证身份）;

**<font color = "red">1.10~1.13：</font>**介绍CA的工作机制、数字证书是怎么验证身份的;

**<font color = "red">1.13~1.20：</font>**介绍https中数字证书的实际使用场景。

以上内容来自：http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html



## 3、伪造CA机构的情况

在我从B站中找到的一篇文章中有介绍防止这种情况的办法。

道格伪造了一个CA机构（记作：PCA），这个PCA有自己的私钥m1和公钥m2（这一对m1、m2的作用是模拟CA机构为别人颁发证书），道格也有自己私人的私钥p1和公钥p2；道格使用m1对自己私人的公钥p2和一段相关信息进行加密，做成一个数字证书（记作Q），道格又伪造了一段鲍勃发送的消息（记作X），用p1给X做数字签名（记作X1），之后道格偷偷将苏珊存放在本地的CA公钥换成自己的PCA机构的公钥m2，之后道格将伪造的鲍勃的信息（X+X1+Q）给苏珊发送消息，苏珊拿着PCA的公钥去对Q解密，获得道格伪造的证书Q中道格私人的公钥P2，之后使用这个公钥对X1进行解密，判断是否有人对信息X进行了篡改。

以上的步骤就是我猜测的道格伪造了一个CA机构，伪装别人发送消息的过程。

但是在代码随想录的八股文中对这个PCA的情况有说明：如果遇到伪造CA，就会将这个CA加入到CRL证书吊销列表中，终止信任。