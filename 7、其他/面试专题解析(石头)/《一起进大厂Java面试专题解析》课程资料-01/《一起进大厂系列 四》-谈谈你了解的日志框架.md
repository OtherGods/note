

[TOC]


# 1.为什么需要日志框架
> 通过日志的方式记录系统运行的过程或错误以便定位问题。日志收集，方便后期日志分析！

# 2.常见日志框架
## 2.1.日志框架介绍
对于我们日常开发日志是经常使用的，当然以前的我们可能还傻傻的各种`System.out.println("重要数据")`在控制台输出各种重要数据呢，投入生产的时候再注释掉。到现在为止呢，已经有很多日志可供选择了，而市面上常见的日志框架有很多，比如：`JCL`、`SLF4J`、`Jboss-logging`、`jUL(Java Util Logging)`、`log4j`、`log4j2`、`logback`等等，我们该如何选择呢？

## 2.2.市面上的日志框架

JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j…
|  日志的抽象层| 日志实现 |
|--|--|
| ~~JCL（Jakarta Commons Logging）~~  **SLF4j（Simple Logging Facade for Java）** ~~jboss-logging~~  | Log4j JUL（java.util.logging） Log4j2 **Logback** |

左边选一个抽象层、右边来选一个实现；类似与我们经常使用的JDBC一样，选择不同的数据库驱动。

**下面我们先看看日志的抽象层**：JCL大家应该很熟悉，Commons Logging，spring中常用的框架最后一次更新2014年~~~；jboss-logging使用的场景太少了；就剩下SLF4j了也是我们springboot中使用的日志抽象层。

**日志实现**：大家应该看着都很熟悉把Log4j大家应该用的挺多的，Logback是Log4j的升级版本出至于同一个人开发的，考虑到以后的升级使用等问题，又写出了SLF4j的日志抽象层使用起来更加灵活。JUL（java.util.logging）一看就知道是java util包下的；Log4j2 咋一看像是Log4j的升级版本，其实并不是，它是apache下生产的日志框架。

>SpringBoot底层是Spring框架  ,   Spring框架默认使用JCL.
>
>SpringBoot选用SLF4j    和 Logback

# 3.Slf4j使用

## 3.1.如何在系统中使用SLF4j
slf4j官网： [https://www.slf4j.org](https://www.slf4j.org)

开发的时候，日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法；
给系统里面导入slf4j的jar和 logback的实现jar就可以。

**使用示例**：

```java
package com.bruceliu.controller;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HelloWorld {

    public static void main(String[] args) {
        Logger logger = LoggerFactory.getLogger(HelloWorld.class);
        logger.info("Hello World");
    }
}
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210630113925924.png)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210630114034394.png)

我们现在已经知道了springboot中使用的是 SLF4j和logback，但是如果我们想使用log4j该怎么办呢，从上面的图示中我们可以看出想要使用log4j我们肯定还是要使用 SLF4j作为抽象层，但是中间给我们加入了一层适配层（Adaptation layer）然后使用log4j进行实现，那么我们需要导入图示中的jar包即可，其他的也是一样了。所以说，**以后开发的时候，日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法**； **每一个日志的实现框架都有自己的配置文件。使用slf4j以后，配置文件还是做成日志实现框架自己本身的配置文件**；

## 3.2.可能存在的问题

现在开发中我么想使用slf4j+logback，但是对于一些遗留项目中例如Spring（commons-logging）、Hibernate（jboss-logging）…等等，如何去做到日志同一呢？

你想到的问题SLF4j能想不到吗？答案是可以的，我们看看下面的图就明白了
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210630114110488.png)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210630114130932.png)

**如何让系统中所有的日志都统一到slf4j；**

>1、将系统中其他日志框架先排除出去；
>
>2、用中间包来替换原有的日志框架；
>
>3、我们导入slf4j其他的实现


其实通过idea我们创建一个springboot项目也可以查看日志依赖（截取其中部分）：
SpringBoot使用它来做日志功能：

```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-logging</artifactId>
</dependency>
```

```xml
<parent>
     <groupId>org.springframework.boot</groupId>
     <artifactId>spring-boot-starter-parent</artifactId>
     <version>1.3.2.RELEASE</version>
     <relativePath/> <!-- lookup parent from repository -->
</parent>
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210630114230295.png)

**总结：**
　　1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录
　　2）、SpringBoot也把其他的框架的日志都替换成了slf4j；
　　3）、如果我们要引入其他框架？
　　
**SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可**

示例：

```xml
<dependency>
<groupId>org.springframework</groupId>
<artifactId>spring-core</artifactId>
	<exclusions>
		<exclusion>
			<groupId>commons-logging</groupId>
			<artifactId>commons-logging</artifactId>
		</exclusion>
	</exclusions>
</dependency>
```

 # 4.SpringBoot日志的默认配置

 SpringBoot日志的默认配置的位置：
 ![在这里插入图片描述](https://img-blog.csdnimg.cn/20201020234443232.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20201020234503809.png)


```css
package com.bruceliu;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

@RunWith(SpringRunner.class)
@SpringBootTest
public class Springboot1ApplicationTests {

    // 日志记录器
    private Logger logger = LoggerFactory.getLogger(getClass());

    @Test
    public void contextLoads() {
        // System.out.println();
        // 日志的级别:由低到高
        // trace<debug<info<warn<error
        // 可以调整需要输出的日志级别: 日志就只会在这个级别及以后的高级别生效
        logger.trace("这是trace日志...");
        logger.debug("这是debug日志...");
        // SpringBoot默认使用的是info级别的, 没有指定级别的就使用SpringBoot默认规定的级别
        logger.info("这是info日志...");
        logger.warn("这是warn日志...");
        logger.error("这是error日志...");
    }

}
```
**其他配置**

设置日志的级别: logging.level

```java
#修改日志的级别，默认root是info
logging.level.root=trace
```
指定日志的文件名: logging.file ,会在当前项目下生成springboot.log日志

```java
# 不指定路径在当前项目下生成springboot.log日志
logging.file=springboot.log

# 可以指定完整的路径；
logging.file=d://springboot.log
```
指定日志的文件的目录: logging.path , 日志文件名称使用SpringBoot默认的输出日志文件名.

```java
# 在当前磁盘的根路径下创建spring文件夹和里面的log文件夹；使用spring.log 作为默认文件
logging.path=/spring/log
```
如果同时指定了 logging.file , 则使用 logging.file , 不会使用 logging.path

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201020235207725.png#pic_center)

指定日志在控制台输出的格式: logging.pattern.console

```css
# 在控制台输出的日志的格式
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n
```
指定文件中日志输出的格式: logging.pattern.file

```css
# 指定文件中日志输出的格式
logging.pattern.file=%d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n
```

**日志的输出格式**
![在这里插入图片描述](https://img-blog.csdnimg.cn/20201020233216229.png)

# 5.SpringBoot指定日志文件

 如果还是不够用的话，可以自定义配置。给类路径下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的
 ![在这里插入图片描述](https://img-blog.csdnimg.cn/20201020233739846.png)

**logback.xml**示例

logback.xml：直接就被日志框架识别了；
```xml
<?xml version="1.0" encoding="UTF-8"?>
 <configuration>
 <jmxConfigurator />

 <!-- 日志添加到控制台 -->
 <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
     <encoder>
         <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
     </encoder>
 </appender>

 <!-- 滚动记录文件，先将日志记录到指定文件，当符合某个条件时，将日志记录到其他文件 -->
 <appender name="rollingFile" class="ch.qos.logback.core.rolling.RollingFileAppender">
     <file>logs/quickstart.log</file>
     <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
         <fileNamePattern>logs/smt.%d{yyyy-MM-dd}.log</fileNamePattern>
     </rollingPolicy>
     <encoder>
         <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
     </encoder>
 </appender>

 <appender name="businessLogFile" class="ch.qos.logback.core.rolling.RollingFileAppender">
     <!-- 按每小时滚动文件，如果一个小时内达到10M也会滚动文件, 滚动文件将会压缩成zip格式 -->
     <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
         <fileNamePattern>logs/smt-%d{yyyy-MM-dd_HH}.%i.zip</fileNamePattern>
         <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
             <maxFileSize>10MB</maxFileSize>
         </timeBasedFileNamingAndTriggeringPolicy>
     </rollingPolicy>
     <!-- 独立的pattern -->
     <encoder>
         <pattern>%d{HH:mm:ss.SSS},%msg%n</pattern>
     </encoder>
 </appender>

 <!-- project default level 本身没有指定appender不打印 传递给上级root-->
 <logger name="com.github.miemiedev.smt" level="DEBUG" />
 <logger name="org.mybatis.spring.SqlSessionFactoryBean" level="DEBUG" />



 <!--log4jdbc -->
 <!-- <logger name="jdbc.sqltiming" level="INFO"/> -->

 <root level="WARN">
     <appender-ref ref="console" />
     <appender-ref ref="rollingFile" />
 </root>
 </configuration>
```

logback-spring.xml：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot 的高级Proﬁle功能


```xml
<!-- 日志添加到控制台 -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <layout class="ch.qos.logback.classic.PatternLayout">
            <springProfile name="dev">
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} ----> [%thread] ---> %-5level %logger{50} - %msg%n</pattern>
            </springProfile>
            <springProfile name="!dev">
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n</pattern>
            </springProfile>
        </layout>
    </appender>
```

```css
#指定当前模式
spring:
  profiles:
    active: dev
```

如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误 `no applicable action for [springProfile]`

 # 6.切换日志框架
弃用SpringBoot官方指定的logback日志框架，改用别的日志框架实现。但没太大实际意义，因为logback是最先进的版本，一般没有必要替换。（不推荐，只是教大家如何切换）
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210630114258576.png)

**pom.xml**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <exclusion>
            <artifactId>logback-classic</artifactId>
            <groupId>ch.qos.logback</groupId>
        </exclusion>
        <exclusion>
            <artifactId>log4j-over-slf4j</artifactId>
            <groupId>org.slf4j</groupId>
        </exclusion>
    </exclusions>
</dependency>

<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-log4j12</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>
```
在resource目录下添加log4j.properties

```properties
log4j.rootCategory=DEBUG, CONSOLE,LOGFILE

log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender
log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout
log4j.appender.CONSOLE.layout.ConversionPattern=-%p-%d{yyyy/MM/dd HH:mm:ss,SSS}-%l-%L-%m%n

log4j.appender.LOGFILE=org.apache.log4j.FileAppender
log4j.appender.logFile.Threshold=DEBUG
log4j.appender.logFile.ImmediateFlush=true
log4j.appender.LOGFILE.Append=true
log4j.appender.LOGFILE.File=mylog.log
log4j.appender.LOGFILE.layout=org.apache.log4j.PatternLayout
log4j.appender.LOGFILE.layout.ConversionPattern=-%p-%d{yyyy/MM/dd HH:mm:ss,SSS}-%l-%L-%m%n
```

