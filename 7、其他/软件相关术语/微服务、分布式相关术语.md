# 预热/冷启动

在 Sentinel 中，**预热（Warm Up）机制** 和 **冷启动（Cold Start）** 是密切相关的两个概念，它们共同解决的是：

> **系统刚启动或服务刚上线时，突发流量可能压垮系统的问题。**

## 冷启动（Cold Start）是什么？

当服务刚启动时，如果立刻放开全部流量，系统可能因为还没有准备好（比如缓存未加载、JIT未生效、线程池未满）而被瞬间击垮。

## 预热（Warm Up）机制是如何应对的？

Sentinel 提供了 **预热流控策略（WARM_UP 模式）**，用于控制服务刚启动时的流量增长速度。

### 目标：

让系统在一段“预热期”内，**逐步提升通过的 QPS**，避免瞬时洪峰。

## 背后的实现思想（漏斗模型）

在 `WARM_UP` 模式中，Sentinel 会基于设定的 **最大 QPS** 和 **预热时间**，计算一个阈值曲线，随着时间流逝，令牌生成速率逐渐变快，从而允许的请求量逐步增多。

## 举个例子：

```java
FlowRule rule = new FlowRule();
rule.setResource("queryUser");
rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
rule.setControlBehavior(RuleConstant.CONTROL_BEHAVIOR_WARM_UP);
rule.setCount(100); // 最大QPS是100
rule.setWarmUpPeriodSec(20); // 预热时间20秒
```

### 效果：

- 服务刚上线时，每秒可能只能放行 **10个请求**。
- 随着时间推移，放行速率逐步上升。
- 到第20秒左右，才允许达到设定的最大 QPS 100。

## 总结关系：

|项目|说明|
|---|---|
|**冷启动**|服务刚启动，性能未达峰值，容易被打爆。|
|**预热机制**|Sentinel 用来缓解冷启动风险的策略：通过限制早期 QPS 并逐步放开。|

换句话说：

> **冷启动是问题，预热机制是解决方案。**
